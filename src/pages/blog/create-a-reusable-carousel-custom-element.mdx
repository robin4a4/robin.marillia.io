---
layout: "../../layouts/post.astro"
title: "Create a reusable carousel custom element"
description: "Use the future scroll timeline API and learn multiple ways to create a reusable carousel custom element."
pubDate: "Aug 07 2023"
---

import CarouselExample from "./components/CarouselExample.astro";

<CarouselExample />

Using the future scroll timeline API, we will create a reusable carousel custom element that should be usable with any framework. This article will show you multiple ways to create a carousel custom element, from vanilla javascript to reusable astro component and react integration.

## No javascript needed, modern CSS is cool

The future scroll timeline API is a new API that allows us to create scroll-based animations. It is currently only supported in Chrome and Edge, but it is usable via [this up-to-date polyfill](https://github.com/flackr/scroll-timeline)

There are two APIs, the CSS API and the JS API, both are supported in the polyfill. With this futur css feature and combined with the already existing scroll snapping directives we are able to create a fully functional carousel without any JS.

We will only add javascript at the end to create clickable thumbnails under the carousel.

## The basic sliding mechanism

The base for our carousel will be a section containing an html list of items, and a div containing corresponding dots indicators:

```html
<section class="carousel">
  <ul class="slides-container">
    <li class="slide">slide 1</li>
    <li class="slide">slide 2</li>
    <li class="slide">slide 2</li>
  </ul>
  <div class="dots-container">
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </div>
</section>
```

For the css we will rely heavily on the `overflow-x`, `scroll-snap-type` and `scroll-snap-align` css properties.

```css
.carousel {
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-width: 100px;
}

.slides-container {
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  display: flex;
  gap: 16px;
}

.slide {
  min-width: 100px;
  height: 200px;
  scroll-snap-align: start;
  list-style: none;
  background: #ededed;
  border-radius: 16px;
  display: grid;
  place-content: center;
}

.dots-container {
  display: flex;
  justify-content: center;
  gap: 8px;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 9999px;
  background-color: cyan;
}
```

And that is all for the sliding behaviors ! Now let's see how we can add the current slide indicator by coloring the corresponding dots.

## The `ViewTimeline` magic

### Animate slides on scroll

First let's see how we can play with the view timelines to animates our slides on horizontal scroll. Start by adding the following line to the `.slide` css class:

```css
 {
  view-timeline: --carousel x;
}
```

This will create a "view" timeline named `--carousel` following the x axis. Then we tell our slides to use the --carousel timeline for their animations by adding this line:

```css
 {
  animation-timeline: --carousel;
}
```

Finally we can use any animations we want on our slides, for example here with `fade-in-out-animation` which fade from opacity 0 to 1 and back to 0:

```css
 {
  animation: linear fade-in-out-animation;
}
```

It give us the following final slide class:

```css
.slide {
  min-width: 100px;
  height: 200px;
  scroll-snap-align: start;
  list-style: none;
  background: #ededed;
  border-radius: 16px;
  display: grid;
  place-content: center;
  view-timeline: --carousel x;
  animation-timeline: --carousel;
  animation: linear fade-in-out-animation;
}
```

## Astro implementation using the javascript Web animation API

```javascript
---
export interface Props {
  itemNumber: number;
}
const { itemNumber } = Astro.props;
---

<carousel-component>
  <ul
    data-slides-container
    class="-mx-16 px-16 pb-16 flex flex-rowoverflow-x-auto flex-no-wrap snap-mandatory snap-x gap-24"
  >
    <slot />
  </ul>
  <div class="flex items-center justify-center gap-8 mt-16 md:hidden">
    {
      [...Array(itemNumber)].map((_, index) => (
        <div
          data-slide-dot={index}
          class="w-12 h-12 mx-2 bg-slate-200 rounded-full"
        />
      ))
    }
  </div>
</carousel-component>

<script>
  import "https://flackr.github.io/scroll-timeline/dist/scroll-timeline.js";

  class CarouselComponent extends HTMLElement {
    keyframes = [
      {
        scale: 1,
        backgroundColor: "#e2e8f0",
      },
      {
        scale: 1.3,
        backgroundColor: "#f472b6",
      },
      {
        scale: 1,
        backgroundColor: "#e2e8f0",
      },
    ];

    connectedCallback() {
      const slidesContainer = this.querySelector(
        "[data-slides-container]"
      ) as HTMLDivElement;
      const slideDots = this.querySelectorAll(
        "[data-slide-dot]"
      ) as NodeListOf<HTMLDivElement>;
      slideDots.forEach((dot, index) => {
        dot.animate(this.keyframes, {
          fill: "both",
          timeline: new ViewTimeline({
            subject: slidesContainer.children[index],
            axis: "inline",
          }),
          rangeStart: 'cover'
          rangeSEnd: 'cover'
        });
      });
    }
  }
  customElements.define("carousel-component", CarouselComponent);
</script>
```
